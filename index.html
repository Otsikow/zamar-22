<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Host redirect disabled to allow both apex and www during DNS/SSL propagation -->
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Zamar - Custom Songs for Every Occasion</title>
    <meta name="description" content="Custom Songs for Weddings, Birthdays, Churches, Campaigns & Businesses - Faith-Based Platform" />
    <meta name="author" content="Zamar" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#FFD700" />
    <link rel="icon" type="image/png" sizes="192x192" href="/lovable-uploads/78355eae-a8bc-4167-9f39-fec08c253f60.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/lovable-uploads/78355eae-a8bc-4167-9f39-fec08c253f60.png" />
    <link rel="apple-touch-icon" href="/lovable-uploads/78355eae-a8bc-4167-9f39-fec08c253f60.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="canonical" href="https://www.zamarsongs.com/" />

    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: blob: https:; font-src 'self' https://fonts.gstatic.com data:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.youtube.com https://s.ytimg.com https://www.youtube-nocookie.com; connect-src 'self' https://*.supabase.co https://*.supabase.in https://*.youtube.com https://*.ytimg.com https://*.googlevideo.com ws: wss:; media-src 'self' https://*.supabase.co https://*.googlevideo.com blob: data:; frame-src 'self' https://www.youtube.com https://www.youtube-nocookie.com; child-src 'self' https://www.youtube.com https://www.youtube-nocookie.com; worker-src 'self' blob:; upgrade-insecure-requests;" />

    <meta property="og:title" content="Zamar - Custom Songs for Every Occasion" />
    <meta property="og:description" content="Custom Songs for Weddings, Birthdays, Churches, Campaigns & Businesses - Faith-Based Platform" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <script>
      (function() {
        try {
          var t = localStorage.getItem("theme") || "system";
          var dark = t === "dark" || (t === "system" && window.matchMedia("(prefers-color-scheme: dark)").matches);
          if (dark) document.documentElement.classList.add("dark");
        } catch (e) {}
      })();
    </script>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          let refreshing = false;
          navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (refreshing) return;
            refreshing = true;
            window.location.reload();
          });

          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('SW registered:', registration);

              // If there's an already waiting service worker, activate it immediately
              if (registration.waiting) {
                try { registration.waiting.postMessage({ type: 'SKIP_WAITING' }); } catch (e) {}
              }

              // Listen for updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                if (!newWorker) return;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('New content available; refreshing soonâ€¦');
                    // skipWaiting is called inside SW install; controllerchange will trigger reload
                  }
                });
              });
            })
            .catch(err => console.log('SW registration failed:', err));
        });
      }

      // PWA install prompt - limit frequency
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        const lastPrompted = localStorage.getItem('pwa-install-prompted');
        const now = Date.now();
        const dayInMs = 24 * 60 * 60 * 1000;
        
        // Only prompt if never prompted before or if it's been more than 7 days
        if (!lastPrompted || (now - parseInt(lastPrompted)) > (7 * dayInMs)) {
          console.log('PWA install prompt triggered');
          e.preventDefault();
          deferredPrompt = e;
          localStorage.setItem('pwa-install-prompted', now.toString());
          // You can show a custom install button here
        } else {
          e.preventDefault(); // Still prevent the default prompt
        }
      });
    </script>
  </body>
</html>
